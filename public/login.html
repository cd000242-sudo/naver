<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>ë¼ì´ì„ ìŠ¤ ì¸ì¦</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --gold-primary: #D4AF37;
      --gold-bright: #FFD700;
      --gold-light: #F4D03F;
      --gold-dark: #B8941F;
      --bg-dark: #0F0F0F;
      --bg-secondary: #1A1A1A;
      --bg-card: #1E1E1E;
      --bg-input: #2A2A2A;
      --border-gold: rgba(212, 175, 55, 0.5);
      --text-gold: #FFD700;
      --text-gold-light: #F4D03F;
      --text-muted: #C9A961;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
      background: linear-gradient(135deg, #0F0F0F 0%, #1A1A1A 50%, #0F0F0F 100%);
      background-attachment: fixed;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
      position: relative;
      overflow: hidden;
    }

    body::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background:
        radial-gradient(circle at 20% 50%, rgba(212, 175, 55, 0.1) 0%, transparent 50%),
        radial-gradient(circle at 80% 50%, rgba(255, 215, 0, 0.08) 0%, transparent 50%);
      pointer-events: none;
      z-index: 0;
    }

    .login-container {
      background: linear-gradient(135deg, #1E1E1E 0%, #252525 100%);
      border: 2px solid var(--border-gold);
      border-radius: 16px;
      box-shadow:
        0 20px 60px rgba(0, 0, 0, 0.8),
        0 0 30px rgba(212, 175, 55, 0.2),
        inset 0 1px 0 rgba(255, 215, 0, 0.1);
      padding: 30px 40px;
      width: 100%;
      max-width: 480px;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      z-index: 1;
    }

    .login-container::-webkit-scrollbar {
      width: 8px;
    }

    .login-container::-webkit-scrollbar-track {
      background: rgba(212, 175, 55, 0.1);
      border-radius: 4px;
    }

    .login-container::-webkit-scrollbar-thumb {
      background: var(--gold-primary);
      border-radius: 4px;
    }

    .login-container::-webkit-scrollbar-thumb:hover {
      background: var(--gold-bright);
    }

    .login-header {
      text-align: center;
      margin-bottom: 25px;
    }

    .login-header h1 {
      background: linear-gradient(135deg, #FFD700 0%, #F4D03F 50%, #D4AF37 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 12px;
      text-shadow: 0 0 20px rgba(255, 215, 0, 0.3);
      letter-spacing: -0.5px;
    }

    .login-header p {
      color: var(--text-muted);
      font-size: 15px;
      font-weight: 400;
    }

    .form-group {
      margin-bottom: 18px;
    }

    .form-group label {
      display: block;
      margin-bottom: 10px;
      color: var(--text-gold-light);
      font-weight: 600;
      font-size: 14px;
      letter-spacing: 0.3px;
    }

    .form-group input {
      width: 100%;
      padding: 14px 16px;
      background: var(--bg-input);
      border: 2px solid rgba(212, 175, 55, 0.3);
      border-radius: 10px;
      font-size: 15px;
      color: var(--text-gold-light);
      transition: all 0.3s ease;
    }

    .form-group input::placeholder {
      color: var(--text-muted);
      opacity: 0.6;
    }

    .form-group input:focus {
      outline: none;
      border-color: var(--gold-bright);
      box-shadow:
        0 0 0 3px rgba(212, 175, 55, 0.2),
        0 0 15px rgba(255, 215, 0, 0.3);
      background: #2F2F2F;
    }

    .remember-checkbox {
      display: flex;
      align-items: center;
      margin-bottom: 18px;
    }

    .remember-checkbox input {
      width: auto;
      margin-right: 10px;
      accent-color: var(--gold-bright);
      cursor: pointer;
    }

    .remember-checkbox label {
      color: var(--text-muted);
      font-weight: normal;
      margin: 0;
      cursor: pointer;
    }

    .divider {
      height: 1px;
      background: linear-gradient(90deg, transparent, var(--border-gold), transparent);
      margin: 18px 0;
      position: relative;
    }

    .divider::before {
      content: '';
      position: absolute;
      left: 50%;
      top: 50%;
      transform: translate(-50%, -50%);
      width: 40px;
      height: 1px;
      background: var(--gold-bright);
      box-shadow: 0 0 10px rgba(255, 215, 0, 0.5);
    }

    .divider-text {
      text-align: center;
      color: var(--text-muted);
      font-size: 13px;
      margin: 12px 0;
      font-weight: 500;
    }

    .login-button {
      width: 100%;
      padding: 16px;
      background: linear-gradient(135deg, #D4AF37 0%, #FFD700 50%, #F4D03F 100%);
      color: #0F0F0F;
      border: none;
      border-radius: 10px;
      font-size: 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      box-shadow:
        0 4px 15px rgba(212, 175, 55, 0.4),
        0 0 20px rgba(255, 215, 0, 0.2);
      letter-spacing: 0.5px;
      text-transform: uppercase;
      position: relative;
      overflow: hidden;
    }

    .login-button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
      transition: left 0.5s;
    }

    .login-button:hover::before {
      left: 100%;
    }

    .login-button:hover {
      transform: translateY(-2px);
      box-shadow:
        0 8px 25px rgba(212, 175, 55, 0.5),
        0 0 30px rgba(255, 215, 0, 0.4);
      background: linear-gradient(135deg, #F4D03F 0%, #FFD700 50%, #FFED4E 100%);
    }

    .login-button:active {
      transform: translateY(0);
    }

    .login-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
      background: linear-gradient(135deg, #B8941F 0%, #D4AF37 50%, #B8941F 100%);
    }

    .free-use-button {
      width: 100%;
      padding: 14px;
      background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
      color: #0F0F0F;
      border: none;
      border-radius: 10px;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
      margin-top: 12px;
    }

    .free-use-button:hover {
      box-shadow: 0 8px 25px rgba(16, 185, 129, 0.35);
      transform: translateY(-1px);
    }

    .free-use-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    .price-button {
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid rgba(212, 175, 55, 0.5);
      background: transparent;
      color: var(--text-gold);
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-top: 10px;
    }

    .price-button:hover {
      background: rgba(212, 175, 55, 0.08);
      box-shadow: 0 0 16px rgba(212, 175, 55, 0.35);
      transform: translateY(-1px);
    }

    .price-section {
      margin-top: 18px;
      padding: 16px;
      border-radius: 12px;
      background: linear-gradient(135deg, rgba(212, 175, 55, 0.08), rgba(0, 0, 0, 0.7));
      border: 1px solid rgba(212, 175, 55, 0.4);
    }

    .purchase-modal-backdrop {
      position: fixed;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.78);
      z-index: 99999;
      padding: 22px;
    }

    /* âœ… í˜ì´ì›” ëª¨ë‹¬ ìŠ¤íƒ€ì¼ ì¶”ê°€ */
    .paywall-modal-backdrop {
      position: fixed;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.85);
      z-index: 100000;
      padding: 24px;
    }

    .paywall-modal {
      width: min(460px, 95vw);
      background: linear-gradient(180deg, #1a1a2e 0%, #0f0f1a 100%);
      border-radius: 20px;
      box-shadow: 0 30px 80px rgba(0, 0, 0, 0.8);
      padding: 32px;
      text-align: center;
    }

    .paywall-message-box {
      padding: 20px;
      border-radius: 14px;
      margin-bottom: 24px;
      line-height: 1.8;
    }

    .paywall-actions {
      display: flex;
      flex-direction: column;
      gap: 14px;
    }

    .paywall-actions .btn-upgrade {
      display: block;
      border-radius: 14px;
      color: #fff;
      font-weight: 900;
      text-decoration: none;
      box-shadow: 0 8px 30px rgba(34, 197, 94, 0.4);
      transition: all 0.2s;
      border: none;
      cursor: pointer;
    }

    .paywall-actions .btn-upgrade:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(34, 197, 94, 0.5);
    }

    .purchase-modal {
      width: min(720px, 95vw);
      max-height: 90vh;
      overflow: auto;
      background: #111;
      border: 1px solid rgba(212, 175, 55, 0.60);
      border-radius: 14px;
      box-shadow: 0 20px 70px rgba(0, 0, 0, 0.65);
      padding: 18px;
    }

    .purchase-modal-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .purchase-modal-title {
      color: #D4AF37;
      font-weight: 900;
      font-size: 16px;
      letter-spacing: 0.2px;
    }

    .purchase-modal-close {
      background: transparent;
      border: 1px solid rgba(212, 175, 55, 0.55);
      color: #D4AF37;
      border-radius: 10px;
      padding: 8px 12px;
      cursor: pointer;
      font-weight: 800;
    }

    .purchase-modal-image {
      width: 100%;
      border-radius: 12px;
      margin-top: 14px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      display: block;
    }

    .purchase-modal-actions {
      margin-top: 14px;
      display: flex;
      justify-content: center;
    }

    .price-section-title {
      color: var(--text-gold-light);
      font-weight: 700;
      font-size: 14px;
      margin-bottom: 10px;
      text-align: center;
    }

    .price-image {
      width: 100%;
      border-radius: 10px;
      border: 1px solid rgba(255, 255, 255, 0.08);
      display: block;
    }

    .open-chat-button {
      margin-top: 12px;
      width: 100%;
      padding: 12px;
      border-radius: 10px;
      border: 1px solid rgba(16, 185, 129, 0.5);
      background: linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);
      color: #0F0F0F;
      font-size: 14px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .open-chat-button:hover {
      box-shadow: 0 8px 24px rgba(16, 185, 129, 0.45);
      transform: translateY(-1px);
    }

    .error-message {
      background: rgba(184, 20, 20, 0.2);
      border: 1px solid rgba(255, 0, 0, 0.3);
      color: #FF6B6B;
      padding: 14px 16px;
      border-radius: 10px;
      margin-bottom: 24px;
      font-size: 14px;
      display: none;
      box-shadow: 0 0 15px rgba(255, 0, 0, 0.1);
    }

    .error-message.show {
      display: block;
    }

    /* ì„±ê³µ ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    .success-modal-backdrop {
      position: fixed;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(8px);
      z-index: 100000;
      animation: fadeIn 0.4s ease-out;
    }

    .success-modal {
      background: linear-gradient(135deg, #1A1A1A 0%, #2A2A2A 100%);
      border: 2px solid var(--gold-primary);
      border-radius: 20px;
      padding: 40px;
      width: 90%;
      max-width: 400px;
      text-align: center;
      box-shadow:
        0 0 50px rgba(212, 175, 55, 0.3),
        inset 0 0 20px rgba(212, 175, 55, 0.1);
      transform: scale(0.9);
      animation: scaleUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    }

    .success-icon {
      font-size: 60px;
      margin-bottom: 20px;
      display: block;
      filter: drop-shadow(0 0 10px rgba(255, 215, 0, 0.5));
    }

    .success-title {
      font-size: 26px;
      font-weight: 800;
      background: linear-gradient(135deg, #FFD700 0%, #D4AF37 100%);
      -webkit-background-clip: text;
      background-clip: text;
      -webkit-text-fill-color: transparent;
      margin-bottom: 15px;
    }

    .success-message {
      color: #E0E0E0;
      font-size: 16px;
      line-height: 1.6;
      margin-bottom: 25px;
    }

    .license-info-box {
      background: rgba(212, 175, 55, 0.1);
      border: 1px solid rgba(212, 175, 55, 0.3);
      border-radius: 12px;
      padding: 15px;
      margin-bottom: 25px;
    }

    .license-period-label {
      display: block;
      color: var(--text-gold-light);
      font-size: 13px;
      font-weight: 600;
      margin-bottom: 5px;
      text-transform: uppercase;
      letter-spacing: 1px;
    }

    .license-period-value {
      display: block;
      color: #FFFFFF;
      font-size: 18px;
      font-weight: 700;
    }

    .redirect-notice {
      color: #888;
      font-size: 13px;
      margin-top: 10px;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    @keyframes scaleUp {
      from {
        opacity: 0;
        transform: scale(0.8);
      }

      to {
        opacity: 1;
        transform: scale(1);
      }
    }

    /* í˜ì´ì›”(í•œë„ ì´ˆê³¼) ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
    .paywall-modal-backdrop {
      position: fixed;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(8px);
      z-index: 100000;
      animation: fadeIn 0.4s ease-out;
    }

    .paywall-modal {
      background: linear-gradient(135deg, #1A1A1A 0%, #2A2A2A 100%);
      border: 2px solid var(--gold-primary);
      border-radius: 20px;
      padding: 30px;
      width: 90%;
      max-width: 420px;
      text-align: center;
      box-shadow: 0 0 50px rgba(212, 175, 55, 0.3);
      transform: scale(0.9);
      animation: scaleUp 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275) forwards;
    }

    .paywall-message-box {
      background: rgba(255, 107, 107, 0.1);
      border: 1px solid rgba(255, 107, 107, 0.2);
      border-radius: 12px;
      padding: 20px;
      margin: 15px 0;
      color: #FFBABA;
      font-size: 15px;
      line-height: 1.6;
      font-weight: 600;
    }

    .paywall-actions {
      display: flex;
      flex-direction: column;
      gap: 12px;
      margin-top: 20px;
    }

    .btn-upgrade {
      background: linear-gradient(135deg, #FFD700 0%, #D4AF37 100%);
      color: #0F0F0F;
      border: none;
      padding: 16px;
      border-radius: 12px;
      font-size: 16px;
      font-weight: 800;
      cursor: pointer;
      box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
      text-decoration: none;
      transition: transform 0.2s;
    }

    .btn-upgrade:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(212, 175, 55, 0.4);
    }

    .btn-later {
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: rgba(255, 255, 255, 0.7);
      padding: 14px;
      border-radius: 12px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: background 0.2s;
    }

    .btn-later:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .device-id {
      text-align: center;
      color: var(--text-muted);
      font-size: 12px;
      margin-top: 18px;
      padding-top: 15px;
      border-top: 1px solid rgba(212, 175, 55, 0.2);
      font-weight: 500;
    }

    /* âœ… [2026-02-05] ë²„ì „ í‘œì‹œ ìŠ¤íƒ€ì¼ */
    .version-display {
      text-align: center;
      color: var(--text-muted);
      font-size: 11px;
      margin-top: 12px;
      font-weight: 500;
      opacity: 0.7;
    }

    /* ê´€ë¦¬ì ì œì–´ ìŠ¤íƒ€ì¼ */
    .admin-trigger {
      position: fixed;
      bottom: 10px;
      right: 10px;
      width: 20px;
      height: 20px;
      opacity: 0.1;
      cursor: pointer;
      z-index: 1000;
      transition: opacity 0.3s;
    }

    .admin-trigger:hover {
      opacity: 0.5;
    }

    .admin-modal-backdrop {
      position: fixed;
      left: 0;
      top: 0;
      right: 0;
      bottom: 0;
      display: none;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.85);
      backdrop-filter: blur(5px);
      z-index: 110000;
    }

    .admin-modal {
      background: #1A1A1A;
      border: 1px solid var(--gold-primary);
      border-radius: 12px;
      padding: 24px;
      width: 300px;
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.5);
    }

    .admin-modal h3 {
      color: var(--text-gold);
      margin-bottom: profile-detail-label;
      font-size: 16px;
      margin-bottom: 16px;
    }

    .admin-modal input {
      width: 100%;
      padding: 10px;
      background: #2A2A2A;
      border: 1px solid rgba(212, 175, 55, 0.3);
      border-radius: 6px;
      color: white;
      margin-bottom: 16px;
    }

    .admin-modal-actions {
      display: flex;
      gap: 10px;
    }

    .admin-modal-actions button {
      flex: 1;
      padding: 8px;
      border-radius: 6px;
      cursor: pointer;
      font-weight: 600;
    }

    .admin-btn-confirm {
      background: var(--gold-primary);
      color: black;
      border: none;
    }

    .admin-btn-cancel {
      background: transparent;
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
    }

    .admin-control-panel {
      display: none;
      margin-top: 16px;
      padding-top: 16px;
      border-top: 1px solid rgba(212, 175, 55, 0.2);
    }
  </style>
</head>

<body>
  <div class="login-container">
    <div class="login-header">
      <h1>ğŸ” ë¼ì´ì„ ìŠ¤ ì¸ì¦</h1>
      <p>ì•±ì„ ì‚¬ìš©í•˜ë ¤ë©´ ì¸ì¦ì´ í•„ìš”í•©ë‹ˆë‹¤</p>
      <!-- âœ… [2026-02-05] ë²„ì „ í‘œì‹œ ì¶”ê°€ -->
      <div id="app-version-display" class="version-display">ë²„ì „ í™•ì¸ ì¤‘...</div>
    </div>

    <!-- ì„±ê³µ ëª¨ë‹¬ êµ¬ì„± -->
    <div id="success-modal-backdrop" class="success-modal-backdrop">
      <div class="success-modal">
        <span class="success-icon">âœ¨</span>
        <h2 class="success-title">ì¶•í•˜í•©ë‹ˆë‹¤ !!</h2>
        <p class="success-message">ë¼ì´ì„ ìŠ¤ ì¸ì¦ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ğŸ‰</p>

        <div class="license-info-box">
          <span class="license-period-label">ë¼ì´ì„ ìŠ¤ ê¸°ê°„</span>
          <span id="license-period-display" class="license-period-value">í™•ì¸ ì¤‘...</span>
        </div>

        <p class="redirect-notice">ì ì‹œ í›„ ë©”ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤...</p>
      </div>
    </div>

    <button type="button" id="free-use-button" class="free-use-button" style="margin-top: 0; margin-bottom: 18px;">ğŸ‘‘ ë§¤ì¼
      ë°œí–‰ 2íšŒ ë¬´ë£Œ ì‚¬ìš©í•˜ê¸°</button>

    <div id="error-message" class="error-message"></div>

    <form id="login-form">
      <!-- ì´ˆê¸° ì¸ì¦: ë¼ì´ì„ ìŠ¤ ì½”ë“œ + ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ + ì´ë©”ì¼ -->
      <div id="initial-auth-section">
        <div class="form-group">
          <label for="license-code-init">ë¼ì´ì„ ìŠ¤ ì½”ë“œ <span style="color: #ff6b6b;">*</span></label>
          <input type="text" id="license-code-init" placeholder="XXXX-XXXX-XXXX-XXXX (í•˜ì´í”ˆ ì—†ì–´ë„ ë©ë‹ˆë‹¤)">
        </div>

        <div class="form-group">
          <label for="user-id-init">ì•„ì´ë”” (ì›í•˜ëŠ” ì•„ì´ë””) <span style="color: #ff6b6b;">*</span></label>
          <input type="text" id="user-id-init" placeholder="ì‚¬ìš©í•  ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
        </div>

        <div class="form-group">
          <label for="password-init">ë¹„ë°€ë²ˆí˜¸ (ì›í•˜ëŠ” ë¹„ë°€ë²ˆí˜¸) <span style="color: #ff6b6b;">*</span></label>
          <input type="password" id="password-init" placeholder="ì‚¬ìš©í•  ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
        </div>

        <div class="form-group">
          <label for="email-init">ì´ë©”ì¼ <span style="color: #ff6b6b;">*</span></label>
          <input type="email" id="email-init" placeholder="ì´ë©”ì¼ì„ ì…ë ¥í•˜ì„¸ìš”">
        </div>
      </div>

      <!-- ì¬ì¸ì¦: ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ë§Œ -->
      <div id="reauth-section" style="display: none;">
        <div class="form-group">
          <label for="user-id">ì•„ì´ë”” <span style="color: #ff6b6b;">*</span></label>
          <input type="text" id="user-id" placeholder="ë“±ë¡í•œ ì•„ì´ë””ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
        </div>

        <div class="form-group">
          <label for="password">ë¹„ë°€ë²ˆí˜¸ <span style="color: #ff6b6b;">*</span></label>
          <input type="password" id="password" placeholder="ë“±ë¡í•œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•˜ì„¸ìš”">
        </div>

        <div class="remember-checkbox">
          <input type="checkbox" id="remember-credentials">
          <label for="remember-credentials" style="margin: 0; font-weight: normal;">ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ê¸°ì–µí•˜ê¸°</label>
        </div>
        <button type="button" id="clear-credentials-btn"
          style="width: 100%; padding: 10px; margin-top: 8px; border-radius: 8px; border: 1px solid rgba(239, 68, 68, 0.5); background: rgba(239, 68, 68, 0.1); color: #ef4444; font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.2s;">ğŸ—‘ï¸
          ì €ì¥ëœ ë¡œê·¸ì¸ ì •ë³´ ì‚­ì œ</button>
      </div>

      <button type="submit" id="login-button" class="login-button">ì¸ì¦í•˜ê¸°</button>
    </form>

    <!-- í˜ì´ì›” ëª¨ë‹¬ - ì‚­ê° ë¬¸êµ¬ ì ìš© -->
    <div id="paywall-modal-backdrop" class="paywall-modal-backdrop">
      <div class="paywall-modal"
        style="border: 2px solid rgba(239, 68, 68, 0.5); box-shadow: 0 0 50px rgba(239, 68, 68, 0.2);">
        <div style="font-size: 32px; margin-bottom: 12px;">âš ï¸</div>
        <h2
          style="color: #fbbf24; font-size: 20px; font-weight: 900; margin-bottom: 16px; text-shadow: 0 0 15px rgba(251, 191, 36, 0.3);">
          ì‘ì—…ì´ ì¼ì‹œ ì¤‘ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤!</h2>
        <div class="paywall-message-box"
          style="background: rgba(251, 191, 36, 0.08); border: 1px solid rgba(251, 191, 36, 0.2); color: rgba(255,255,255,0.95);">
          <div style="font-size: 16px; margin-bottom: 14px;">ì˜¤ëŠ˜ ë¬´ë£Œ ì‚¬ìš©ëŸ‰ì„ ëª¨ë‘ ì“°ì…¨ìŠµë‹ˆë‹¤.</div>
          <div style="color: #ef4444; font-weight: 700;">ì§€ê¸ˆ ë©ˆì¶”ë©´ ë¸”ë¡œê·¸ ì§€ìˆ˜ ìƒìŠ¹ë„ ë©ˆì¶¥ë‹ˆë‹¤.</div>
          <div
            style="margin-top: 16px; padding-top: 14px; border-top: 1px solid rgba(255,255,255,0.1); color: #22c55e; font-weight: 700;">
            íë¦„ ëŠê¸°ì§€ ì•Šê³  ê³„ì† ìˆ˜ìµì„ ë‚´ì‹œê² ìŠµë‹ˆê¹Œ?
          </div>
        </div>

        <div class="paywall-actions">
          <button id="paywall-upgrade-btn" class="btn-upgrade"
            style="background: linear-gradient(135deg, #22c55e 0%, #16a34a 100%); padding: 18px; font-size: 17px;">ğŸš€
            ë¬´ì œí•œìœ¼ë¡œ ë´‰ì¸ í•´ì œí•˜ê¸°</button>
          <button id="paywall-later-btn"
            style="background: transparent; border: none; color: rgba(255,255,255,0.35); font-size: 13px; padding: 12px; cursor: pointer;">ë„¤,
            ì„±ì¥ì„ ë©ˆì¶œê²Œìš”</button>
        </div>
      </div>
    </div>


    <button type="button" id="price-button" class="price-button">ğŸ’¬ êµ¬ë§¤ ë¬¸ì˜í•˜ê¸°</button>


    <div class="divider-text" style="margin-top: 15px;">
      <a href="#" id="toggle-auth-mode" style="color: var(--text-gold); text-decoration: none; font-size: 13px;">ì´ë¯¸
        ë“±ë¡í–ˆë‚˜ìš”? ë¡œê·¸ì¸í•˜ê¸°</a>
    </div>
    </form>

    <div class="device-id" id="device-id"></div>
  </div>

  <div id="purchase-modal-backdrop" class="purchase-modal-backdrop">
    <div id="purchase-modal" class="purchase-modal">
      <div class="purchase-modal-header">
        <div class="purchase-modal-title">êµ¬ë§¤ ë¬¸ì˜í•˜ê¸°</div>
        <button id="purchase-modal-close" type="button" class="purchase-modal-close">ë‹«ê¸°</button>
      </div>
      <img src="ê°€ê²©í‘œ.jpg" alt="ê°€ê²©í‘œ" class="purchase-modal-image">
      <div class="purchase-modal-actions">
        <button type="button" id="purchase-open-chat-button" class="open-chat-button">ğŸ’¬ ì˜¤í”ˆì±„íŒ…ìœ¼ë¡œ ë¬¸ì˜í•˜ê¸°</button>
      </div>
    </div>
  </div>

  <div id="info-modal-backdrop"
    style="position:fixed;left:0;top:0;right:0;bottom:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.72);z-index:99999;padding:24px;">
    <div id="info-modal"
      style="width:min(520px,95vw);background:#111;border:1px solid rgba(212,175,55,0.60);border-radius:14px;box-shadow:0 20px 70px rgba(0,0,0,0.65);padding:18px;">
      <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;">
        <div id="info-modal-title" style="color:#D4AF37;font-weight:900;font-size:16px;letter-spacing:0.2px;"></div>
        <button id="info-modal-close" type="button"
          style="background:transparent;border:1px solid rgba(212,175,55,0.55);color:#D4AF37;border-radius:10px;padding:8px 12px;cursor:pointer;">ë‹«ê¸°</button>
      </div>
      <div id="info-modal-body"
        style="margin-top:12px;color:rgba(212,175,55,0.95);font-size:14px;font-weight:800;line-height:1.45;white-space:pre-line;">
      </div>
      <div style="margin-top:14px;display:flex;justify-content:center;">
        <button id="info-modal-ok" type="button"
          style="min-width:160px;padding:12px 16px;border-radius:12px;border:1px solid rgba(16,185,129,0.55);background:linear-gradient(135deg, #10b981 0%, #059669 50%, #047857 100%);color:#fff;font-weight:900;cursor:pointer;">í™•ì¸</button>
      </div>
    </div>
  </div>

  <!-- ì‹œë‚˜ë¦¬ì˜¤ 3: ACCESS DENIED (ë¼ì´ì„ ìŠ¤ ë§Œë£Œ ì‹œ í‘œì‹œ) -->
  <div id="access-denied-modal-backdrop"
    style="position:fixed;left:0;top:0;right:0;bottom:0;display:none;align-items:center;justify-content:center;background:rgba(0,0,0,0.92);z-index:100000;padding:24px;">
    <div
      style="width:min(480px,95vw);background:linear-gradient(180deg, #1a1a2e 0%, #0f0f1a 100%);border:2px solid rgba(239,68,68,0.6);border-radius:20px;box-shadow:0 30px 80px rgba(0,0,0,0.8), 0 0 60px rgba(239,68,68,0.15);padding:32px;text-align:center;">
      <div style="font-size:40px;margin-bottom:16px;">â›”</div>
      <h2
        style="color:#ef4444;font-size:22px;font-weight:900;margin-bottom:8px;text-shadow:0 0 20px rgba(239,68,68,0.3);">
        ACCESS DENIED</h2>
      <div style="color:rgba(255,255,255,0.6);font-size:14px;margin-bottom:24px;">(ë¼ì´ì„ ìŠ¤ ë§Œë£Œ)</div>

      <div
        style="padding:20px;background:rgba(239,68,68,0.08);border:1px solid rgba(239,68,68,0.2);border-radius:14px;margin-bottom:24px;color:rgba(255,255,255,0.92);font-size:15px;line-height:1.8;">
        <div style="margin-bottom:12px;font-weight:600;">ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ì´ìš© ê¸°ê°„ì´ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.</div>
        <div style="color:rgba(255,255,255,0.7);">
          ì§€ê¸ˆ ëŒì•„ê°€ì‹œë©´ ë‹¤ì‹œ í‚¤ì›Œë“œ ì°¾ëŠë¼ 1ì‹œê°„,<br>
          ê¸€ ì“°ëŠë¼ 2ì‹œê°„ ì“°ë˜ <span style="color:#fbbf24;font-weight:700;">'ë…¸ë™ì˜ ì‹œê°„'</span>ìœ¼ë¡œ ë³µê·€í•˜ê²Œ ë©ë‹ˆë‹¤.
        </div>
        <div
          style="margin-top:16px;padding-top:12px;border-top:1px solid rgba(255,255,255,0.08);color:rgba(255,255,255,0.8);">
          ì§„ì§œ... ë‹¤ì‹œ ì†ìœ¼ë¡œ ê¸€ ì“°ì‹¤ ê±´ê°€ìš”?<br>
          <span style="color:#22c55e;font-weight:600;">ì»¤í”¼ 2ì” ê°’ìœ¼ë¡œ í•œ ë‹¬ì˜ ììœ ë¥¼ ë‹¤ì‹œ ì‚¬ì„¸ìš”.</span>
        </div>
      </div>

      <div style="display:flex;flex-direction:column;gap:14px;">
        <a id="access-denied-upgrade-btn" href="https://open.kakao.com/o/sPcaslwh" target="_blank"
          style="display:block;padding:18px;text-align:center;border-radius:14px;background:linear-gradient(135deg, #22c55e 0%, #16a34a 100%);color:#fff;font-weight:900;font-size:17px;text-decoration:none;box-shadow:0 8px 30px rgba(34,197,94,0.4);transition:all 0.2s;">ğŸ’
          ë¼ì´ì„ ìŠ¤ ê°±ì‹ í•˜ê³  ë°”ë¡œ ë¡œê·¸ì¸</a>
        <button id="access-denied-close-btn"
          style="padding:12px;background:transparent;border:none;color:rgba(255,255,255,0.3);font-size:13px;cursor:pointer;">ë„¤,
          ê·¸ëƒ¥ ì†ìœ¼ë¡œ ì“¸ê²Œìš”</button>
      </div>
    </div>
  </div>

  <script>
    const { ipcRenderer } = require('electron');
    const KAKAO_OPEN_CHAT_URL = 'https://open.kakao.com/o/sPcaslwh';

    let deviceId = '';

    // ê¸°ê¸° ID ê°€ì ¸ì˜¤ê¸°
    async function loadDeviceId() {
      try {
        deviceId = await ipcRenderer.invoke('license:getDeviceId');
        const deviceIdElement = document.getElementById('device-id');
        if (deviceIdElement) {
          deviceIdElement.textContent = `ê¸°ê¸° ID: ${deviceId.substring(0, 8)}...`;
        }
      } catch (error) {
        console.error('ê¸°ê¸° ID ë¡œë“œ ì‹¤íŒ¨:', error);
      }
    }

    // âœ… [2026-02-05] ì•± ë²„ì „ í‘œì‹œ
    async function loadAppVersion() {
      try {
        const version = await ipcRenderer.invoke('app:getVersion');
        const versionEl = document.getElementById('app-version-display');
        if (versionEl && version) {
          versionEl.textContent = `v${version}`;
        }
      } catch (error) {
        console.error('ë²„ì „ ë¡œë“œ ì‹¤íŒ¨:', error);
      }
    }

    // ì €ì¥ëœ ìê²©ì¦ëª… ë¡œë“œ (ìë™ ë¡œê·¸ì¸ì€ í•˜ì§€ ì•ŠìŒ, ì´ˆê¸° ì¸ì¦ì°½ë§Œ í‘œì‹œ)
    async function loadSavedCredentials() {
      try {
        const config = await ipcRenderer.invoke('config:get');

        // ì €ì¥ëœ ìê²©ì¦ëª…ì´ ìˆëŠ”ì§€ í™•ì¸ (ìë™ ë¡œê·¸ì¸ì€ í•˜ì§€ ì•Šê³ , ì¬ì¸ì¦ ëª¨ë“œë¡œ ì „í™˜í•  ë•Œë§Œ ì‚¬ìš©)
        const hasCredentials = config &&
          config.rememberLicenseCredentials === true &&
          config.savedLicenseUserId &&
          config.savedLicensePassword &&
          config.savedLicenseUserId.trim() !== '' &&
          config.savedLicensePassword.trim() !== '';

        if (hasCredentials) {
          console.log('ì €ì¥ëœ ìê²©ì¦ëª…ì´ ìˆìŠµë‹ˆë‹¤. ì¬ì¸ì¦ ëª¨ë“œë¡œ ì „í™˜ ì‹œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.');
        } else {
          console.log('ì €ì¥ëœ ìê²©ì¦ëª…ì´ ì—†ìŠµë‹ˆë‹¤. ì´ˆê¸° ì¸ì¦ì°½ì„ í‘œì‹œí•©ë‹ˆë‹¤.');
        }

        // ì´ˆê¸° ì¸ì¦ì°½ì„ ê¸°ë³¸ìœ¼ë¡œ í‘œì‹œ (ìë™ ë¡œê·¸ì¸ í•˜ì§€ ì•ŠìŒ)
        // ì‚¬ìš©ìê°€ "ì´ë¯¸ ë“±ë¡í–ˆë‚˜ìš”?"ë¥¼ í´ë¦­í•˜ë©´ ì¬ì¸ì¦ ëª¨ë“œë¡œ ì „í™˜
      } catch (error) {
        console.error('ì €ì¥ëœ ìê²©ì¦ëª… ë¡œë“œ ì‹¤íŒ¨:', error);
      }
    }

    // ì¬ì¸ì¦ ëª¨ë“œë¡œ ì „í™˜ ë° ìë™ ë¡œê·¸ì¸ ì‹œë„ (ì‚¬ìš©ìê°€ "ì´ë¯¸ ë“±ë¡í–ˆë‚˜ìš”?" í´ë¦­ ì‹œ)
    async function switchToReauthModeAndAutoLogin() {
      try {
        const config = await ipcRenderer.invoke('config:get');

        // ì €ì¥ëœ ìê²©ì¦ëª…ì´ ìˆëŠ”ì§€ í™•ì¸
        const hasCredentials = config &&
          config.rememberLicenseCredentials === true &&
          config.savedLicenseUserId &&
          config.savedLicensePassword &&
          config.savedLicenseUserId.trim() !== '' &&
          config.savedLicensePassword.trim() !== '';

        if (!hasCredentials) {
          console.log('ì €ì¥ëœ ìê²©ì¦ëª…ì´ ì—†ìŠµë‹ˆë‹¤. ìˆ˜ë™ ë¡œê·¸ì¸ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
          // ì¬ì¸ì¦ ëª¨ë“œë¡œ ì „í™˜í•˜ë˜ ìë™ ë¡œê·¸ì¸ì€ í•˜ì§€ ì•ŠìŒ
          isReauthMode = true;
          const initialSection = document.getElementById('initial-auth-section');
          const reauthSection = document.getElementById('reauth-section');
          const toggleLink = document.getElementById('toggle-auth-mode');

          initialSection.style.display = 'none';
          reauthSection.style.display = 'block';
          toggleLink.textContent = 'ì²˜ìŒ ì‚¬ìš©í•˜ì‹œë‚˜ìš”? ë“±ë¡í•˜ê¸°';
          return;
        }

        // ì¬ì¸ì¦ ëª¨ë“œë¡œ ì „í™˜
        isReauthMode = true;
        const initialSection = document.getElementById('initial-auth-section');
        const reauthSection = document.getElementById('reauth-section');
        const toggleLink = document.getElementById('toggle-auth-mode');

        initialSection.style.display = 'none';
        reauthSection.style.display = 'block';
        toggleLink.textContent = 'ì²˜ìŒ ì‚¬ìš©í•˜ì‹œë‚˜ìš”? ë“±ë¡í•˜ê¸°';

        const rememberCheckbox = document.getElementById('remember-credentials');
        const userIdInput = document.getElementById('user-id');
        const passwordInput = document.getElementById('password');
        const loginButton = document.getElementById('login-button');

        // ì €ì¥ëœ ìê²©ì¦ëª…ìœ¼ë¡œ í•„ë“œ ì±„ìš°ê¸°
        if (userIdInput) {
          userIdInput.value = config.savedLicenseUserId;
        }
        if (passwordInput) {
          passwordInput.value = config.savedLicensePassword;
        }

        // ì‚¬ìš©ìê°€ ì´ì „ì— ì²´í¬ë°•ìŠ¤ë¥¼ ì²´í¬í–ˆë‹¤ë©´ ìë™ìœ¼ë¡œ ì²´í¬í•˜ê³  ìë™ ë¡œê·¸ì¸ ì‹œë„
        if (rememberCheckbox && config.rememberLicenseCredentials === true) {
          rememberCheckbox.checked = true;
          console.log('ì €ì¥ëœ ìê²©ì¦ëª…ì´ ìˆê³  ìë™ ë¡œê·¸ì¸ì´ í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ìë™ ë¡œê·¸ì¸ì„ ì‹œë„í•©ë‹ˆë‹¤...');

          // ìë™ ë¡œê·¸ì¸ ì‹œë„ (15ì´ˆ íƒ€ì„ì•„ì›ƒ)
          if (loginButton) {
            loginButton.disabled = true;
            loginButton.textContent = 'ìë™ ë¡œê·¸ì¸ ì¤‘...';
          }

          try {
            // 15ì´ˆ íƒ€ì„ì•„ì›ƒ ì„¤ì •
            const timeoutPromise = new Promise((_, reject) => {
              setTimeout(() => reject(new Error('ìë™ ë¡œê·¸ì¸ íƒ€ì„ì•„ì›ƒ (15ì´ˆ)')), 15000);
            });

            const verifyPromise = ipcRenderer.invoke('license:verifyWithCredentials', config.savedLicenseUserId, config.savedLicensePassword, deviceId);

            const result = await Promise.race([verifyPromise, timeoutPromise]);

            console.log('[Login] ìë™ ë¡œê·¸ì¸ ì‘ë‹µ:', result);
            console.log('[Login] ìë™ ë¡œê·¸ì¸ ì‘ë‹µ ì „ì²´ (JSON):', JSON.stringify(result, null, 2));

            // ë””ë²„ê·¸ ì •ë³´ ì¶œë ¥
            if (result && result.debugInfo) {
              console.log('ğŸ” [Login] ìë™ ë¡œê·¸ì¸ ë””ë²„ê·¸ ì •ë³´:');
              if (result.debugInfo.verify) {
                console.log('ğŸ” [Login] - action:', result.debugInfo.verify.action);
                console.log('ğŸ” [Login] - userId:', result.debugInfo.verify.userId);
                console.log('ğŸ” [Login] - fullResponse:', JSON.stringify(result.debugInfo.verify.fullResponse, null, 2));
                console.log('ğŸ” [Login] - ok:', result.debugInfo.verify.ok);
                console.log('ğŸ” [Login] - valid:', result.debugInfo.verify.valid);
              }
            }

            // âœ… ì‹¤ì œ ì„œë²„ ì‘ë‹µ í™•ì¸: debugInfo.verify.fullResponseì—ì„œ ì²´í¬
            const verifyResponse = result?.debugInfo?.verify?.fullResponse;

            // ì„œë²„ ì‘ë‹µì˜ okì™€ validë¥¼ ë°˜ë“œì‹œ í™•ì¸
            if (verifyResponse && verifyResponse.ok !== false && verifyResponse.valid !== false) {
              // ìë™ ë¡œê·¸ì¸ ì„±ê³µ
              console.log('[Login] âœ… ìë™ ë¡œê·¸ì¸ ì„±ê³µ - verifyResponse.ok:', verifyResponse.ok, 'verifyResponse.valid:', verifyResponse.valid);
              await ipcRenderer.invoke('login:success');
              window.close();
            } else {
              // ìë™ ë¡œê·¸ì¸ ì‹¤íŒ¨
              let errorMessage = 'ìë™ ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.';

              if (verifyResponse) {
                if (verifyResponse.ok === false) {
                  errorMessage = verifyResponse.error || verifyResponse.message || 'ì„œë²„ì—ì„œ ì¸ì¦ì„ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤.';
                  console.error('[Login] âŒ ìë™ ë¡œê·¸ì¸ ì„œë²„ ê±°ë¶€:', errorMessage);
                } else if (verifyResponse.valid === false) {
                  errorMessage = verifyResponse.message || verifyResponse.error || 'ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                  console.error('[Login] âŒ ìë™ ë¡œê·¸ì¸ ì¸ì¦ ì‹¤íŒ¨:', errorMessage);
                }
              } else if (!result.valid) {
                errorMessage = result.message || 'ìë™ ë¡œê·¸ì¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.';
                console.error('[Login] âŒ ìë™ ë¡œê·¸ì¸ ì‹¤íŒ¨ - result.valid:', result.valid, 'result.message:', result.message);
              }

              console.log('[Login] âŒ ìë™ ë¡œê·¸ì¸ ì‹¤íŒ¨:', errorMessage);
              showError(errorMessage);
              if (loginButton) {
                loginButton.disabled = false;
                loginButton.textContent = 'ì¸ì¦í•˜ê¸°';
              }
            }
          } catch (error) {
            console.error('[Login] ìë™ ë¡œê·¸ì¸ ì˜¤ë¥˜:', error);
            console.error('[Login] ìë™ ë¡œê·¸ì¸ ì˜¤ë¥˜ ìƒì„¸:', {
              message: error.message,
              stack: error.stack,
              name: error.name
            });
            showError(`ìë™ ë¡œê·¸ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
            if (loginButton) {
              loginButton.disabled = false;
              loginButton.textContent = 'ì¸ì¦í•˜ê¸°';
            }
          }
        } else {
          // ìë™ ë¡œê·¸ì¸ì´ í™œì„±í™”ë˜ì§€ ì•Šì•˜ê±°ë‚˜ ì €ì¥ëœ ìê²©ì¦ëª…ì´ ì—†ìŒ
          console.log('ì €ì¥ëœ ìê²©ì¦ëª…ìœ¼ë¡œ í•„ë“œë¥¼ ì±„ì› ìŠµë‹ˆë‹¤. ì‚¬ìš©ìê°€ ì§ì ‘ "ì¸ì¦í•˜ê¸°" ë²„íŠ¼ì„ ëˆŒëŸ¬ì•¼ í•©ë‹ˆë‹¤.');
        }
      } catch (error) {
        console.error('ì¬ì¸ì¦ ëª¨ë“œ ì „í™˜ ì‹¤íŒ¨:', error);
      }
    }

    // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ (+ ë¼ì´ì„ ìŠ¤ ë§Œë£Œ ì‹œ ACCESS DENIED ëª¨ë‹¬ í‘œì‹œ)
    function showError(message) {
      // ë¨¼ì € ACCESS DENIED ëª¨ë‹¬ í‘œì‹œ ì—¬ë¶€ í™•ì¸
      const expiredKeywords = ['ë§Œë£Œ', 'ì¢…ë£Œ', 'expired', 'invalid', 'ìœ íš¨í•˜ì§€', 'ë¼ì´ì„ ìŠ¤ê°€ ì—†', 'ì ‘ê·¼ ê±°ë¶€', 'ê¸°ê°„', 'denied'];
      const isExpired = expiredKeywords.some(kw => String(message).toLowerCase().includes(kw.toLowerCase()));
      if (isExpired) {
        showAccessDeniedModal();
        return; // ACCESS DENIED ëª¨ë‹¬ë§Œ í‘œì‹œí•˜ê³  ê¸°ë³¸ ì˜¤ë¥˜ ë©”ì‹œì§€ëŠ” ìˆ¨ê¹€
      }

      const errorElement = document.getElementById('error-message');
      if (errorElement) {
        errorElement.textContent = message;
        errorElement.classList.add('show');
      }
    }

    // ì—ëŸ¬ ë©”ì‹œì§€ ìˆ¨ê¸°ê¸°
    function hideError() {
      const errorElement = document.getElementById('error-message');
      if (errorElement) {
        errorElement.classList.remove('show');
      }
    }

    function showInfoModal(title, message) {
      try {
        window.scrollTo({ top: 0, left: 0, behavior: 'smooth' });
      } catch (e) {
        window.scrollTo(0, 0);
      }
      const backdrop = document.getElementById('info-modal-backdrop');
      const titleEl = document.getElementById('info-modal-title');
      const bodyEl = document.getElementById('info-modal-body');
      if (titleEl) titleEl.textContent = String(title || '').trim();
      if (bodyEl) bodyEl.textContent = String(message || '').trim();
      if (backdrop) backdrop.style.display = 'flex';
    }

    function hideInfoModal() {
      const backdrop = document.getElementById('info-modal-backdrop');
      if (backdrop) backdrop.style.display = 'none';
    }

    document.getElementById('info-modal-close')?.addEventListener('click', hideInfoModal);
    document.getElementById('info-modal-ok')?.addEventListener('click', hideInfoModal);
    document.getElementById('info-modal-backdrop')?.addEventListener('click', (e) => {
      if (e && e.target && e.target.id === 'info-modal-backdrop') {
        hideInfoModal();
      }
    });

    // ACCESS DENIED ëª¨ë‹¬ (ë¼ì´ì„ ìŠ¤ ë§Œë£Œ ì‹œ)
    function showAccessDeniedModal() {
      const backdrop = document.getElementById('access-denied-modal-backdrop');
      if (backdrop) backdrop.style.display = 'flex';
    }

    function hideAccessDeniedModal() {
      const backdrop = document.getElementById('access-denied-modal-backdrop');
      if (backdrop) backdrop.style.display = 'none';
    }

    document.getElementById('access-denied-close-btn')?.addEventListener('click', hideAccessDeniedModal);
    document.getElementById('access-denied-modal-backdrop')?.addEventListener('click', (e) => {
      if (e && e.target && e.target.id === 'access-denied-modal-backdrop') {
        hideAccessDeniedModal();
      }
    });

    // ë¼ì´ì„ ìŠ¤ ë§Œë£Œ ê°ì§€ ì‹œ ACCESS DENIED ëª¨ë‹¬ í‘œì‹œ
    function checkAndShowAccessDenied(errorMessage) {
      const expiredKeywords = ['ë§Œë£Œ', 'ì¢…ë£Œ', 'expired', 'invalid', 'ìœ íš¨í•˜ì§€', 'ë¼ì´ì„ ìŠ¤ê°€ ì—†', 'ì ‘ê·¼ ê±°ë¶€'];
      const isExpired = expiredKeywords.some(kw => String(errorMessage).toLowerCase().includes(kw.toLowerCase()));
      if (isExpired) {
        showAccessDeniedModal();
        return true;
      }
      return false;
    }

    // âœ… ì €ì¥ëœ ìê²©ì¦ëª… ì‚­ì œ í•¨ìˆ˜
    async function clearSavedCredentials() {
      try {
        const config = await ipcRenderer.invoke('config:get');
        const updatedConfig = {
          ...config,
          rememberLicenseCredentials: false,
          savedLicenseUserId: '',
          savedLicensePassword: '',
        };
        await ipcRenderer.invoke('config:save', updatedConfig);
        console.log('[Login] âœ… ì €ì¥ëœ ìê²©ì¦ëª…ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
        return true;
      } catch (error) {
        console.error('[Login] ìê²©ì¦ëª… ì‚­ì œ ì‹¤íŒ¨:', error);
        return false;
      }
    }

    // âœ… ì €ì¥ëœ ë¡œê·¸ì¸ ì •ë³´ ì‚­ì œ ë²„íŠ¼ ì´ë²¤íŠ¸
    document.getElementById('clear-credentials-btn')?.addEventListener('click', async () => {
      const confirmed = confirm('ì €ì¥ëœ ë¡œê·¸ì¸ ì •ë³´ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nì‚­ì œ í›„ì—ëŠ” ë‹¤ì‹œ ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì•¼ í•©ë‹ˆë‹¤.');
      if (!confirmed) return;

      const success = await clearSavedCredentials();
      if (success) {
        // UI ì—…ë°ì´íŠ¸
        const rememberCheckbox = document.getElementById('remember-credentials');
        const userIdInput = document.getElementById('user-id');
        const passwordInput = document.getElementById('password');

        if (rememberCheckbox) rememberCheckbox.checked = false;
        if (userIdInput) userIdInput.value = '';
        if (passwordInput) passwordInput.value = '';

        // ì„±ê³µ ë©”ì‹œì§€
        showInfoModal('âœ… ì‚­ì œ ì™„ë£Œ', 'ì €ì¥ëœ ë¡œê·¸ì¸ ì •ë³´ê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.\nì´ì œ ì§ì ‘ ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
      } else {
        showError('ë¡œê·¸ì¸ ì •ë³´ ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
      }
    });

    // âœ… ì²´í¬ë°•ìŠ¤ í•´ì œ ì‹œ ì €ì¥ëœ ìê²©ì¦ëª… ì‚­ì œ
    document.getElementById('remember-credentials')?.addEventListener('change', async (e) => {
      const checkbox = e.target;
      if (!checkbox.checked) {
        // ì²´í¬ í•´ì œ ì‹œ ì €ì¥ëœ ìê²©ì¦ëª… ì‚­ì œ
        console.log('[Login] ì²´í¬ë°•ìŠ¤ í•´ì œë¨ - ì €ì¥ëœ ìê²©ì¦ëª… ì‚­ì œ ì§„í–‰');
        await clearSavedCredentials();
      }
    });

    // ì¸ì¦ ëª¨ë“œ í† ê¸€
    let isReauthMode = false;

    document.getElementById('toggle-auth-mode')?.addEventListener('click', async (e) => {
      e.preventDefault();

      if (!isReauthMode) {
        // ì´ˆê¸° ì¸ì¦ ëª¨ë“œ â†’ ì¬ì¸ì¦ ëª¨ë“œë¡œ ì „í™˜ (ìë™ ë¡œê·¸ì¸ ì‹œë„)
        await switchToReauthModeAndAutoLogin();
      } else {
        // ì¬ì¸ì¦ ëª¨ë“œ â†’ ì´ˆê¸° ì¸ì¦ ëª¨ë“œë¡œ ì „í™˜
        isReauthMode = false;
        const initialSection = document.getElementById('initial-auth-section');
        const reauthSection = document.getElementById('reauth-section');
        const toggleLink = document.getElementById('toggle-auth-mode');

        initialSection.style.display = 'block';
        reauthSection.style.display = 'none';
        toggleLink.textContent = 'ì´ë¯¸ ë“±ë¡í–ˆë‚˜ìš”? ë¡œê·¸ì¸í•˜ê¸°';
      }

      hideError();
    });

    // í˜ì´ì›” ëª¨ë‹¬ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
    document.getElementById('paywall-later-btn')?.addEventListener('click', () => {
      const modal = document.getElementById('paywall-modal-backdrop');
      if (modal) modal.style.display = 'none';
    });

    document.getElementById('paywall-upgrade-btn')?.addEventListener('click', () => {
      const url = 'https://open.kakao.com/o/sPcaslwh';
      try {
        if (window.api?.openExternalUrl) {
          window.api.openExternalUrl(url);
        } else {
          window.open(url, '_blank');
        }
      } catch (e) {
        window.open(url, '_blank');
      }
    });

    document.getElementById('free-use-button')?.addEventListener('click', async () => {
      hideError();
      const btn = document.getElementById('free-use-button');
      const loginButton = document.getElementById('login-button');
      try {
        try {
          const status = await ipcRenderer.invoke('quota:getStatus');
          const used = Number(status?.quota?.usage?.publish) || 0;
          const limit = 2;
          if (status?.success && status?.isFree && (status?.quota?.isPaywalled || used >= limit)) {
            // âœ… ìƒˆë¡œìš´ í˜ì´ì›” ëª¨ë‹¬ í‘œì‹œ
            const paywallModal = document.getElementById('paywall-modal-backdrop');
            if (paywallModal) {
              paywallModal.style.display = 'flex';
            }
            return;
          }
        } catch (e) {
        }
        if (btn) {
          btn.disabled = true;
          btn.textContent = 'ë¬´ë£Œ ì²´í—˜ ì„¤ì • ì¤‘...';
        }
        if (loginButton) {
          loginButton.disabled = true;
        }
        const result = await ipcRenderer.invoke('free:activate');
        if (!result || result.success !== true) {
          const msg = (result && result.message) ? String(result.message) : 'ë¬´ë£Œ ì‚¬ìš©ì ì„¤ì •ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
          const isQuota = /í• ë‹¹ëŸ‰|quota|PAYWALL|ì†Œì§„/i.test(msg);
          if (isQuota) {
            // [ê°œì„ ] ê³ ê¸‰ìŠ¤ëŸ¬ìš´ í˜ì´ì›” ëª¨ë‹¬ í‘œì‹œ
            const paywallModal = document.getElementById('paywall-modal-backdrop');
            if (paywallModal) {
              paywallModal.style.display = 'flex';
            }
          } else {
            showError(msg);
          }
          if (btn) {
            btn.disabled = false;
            btn.textContent = 'ğŸ‘‘ ë¬´ë£Œë¡œ ì²´í—˜í•´ë³´ê¸°';
          }
          if (loginButton) {
            loginButton.disabled = false;
          }
          return;
        }
        showInfoModal(
          'âœ… í™˜ì˜í•©ë‹ˆë‹¤!',
          'ë¬´ë£Œ 2íšŒ ë°œí–‰ ê°€ëŠ¥í•©ë‹ˆë‹¤.\nPro ë²„ì „ì€ ì˜¤í”ˆì±„íŒ…ìœ¼ë¡œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.'
        );
        window.setTimeout(async () => {
          try {
            await ipcRenderer.invoke('login:success');
          } catch (e) {
          }
          window.close();
        }, 1100);
      } catch (error) {
        showError(`ë¬´ë£Œ ì‚¬ìš©ì ì„¤ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ${error.message}`);
        if (btn) {
          btn.disabled = false;
          btn.textContent = 'ğŸ‘‘ ë¬´ë£Œë¡œ ì²´í—˜í•´ë³´ê¸°';
        }
        if (loginButton) {
          loginButton.disabled = false;
        }
      }
    });

    // êµ¬ë§¤ ë¬¸ì˜í•˜ê¸° ëª¨ë‹¬
    const purchaseBackdrop = document.getElementById('purchase-modal-backdrop');
    const purchaseClose = document.getElementById('purchase-modal-close');

    const openPurchaseModal = () => {
      hideError();
      if (purchaseBackdrop) {
        purchaseBackdrop.style.display = 'flex';
      }
    };

    const closePurchaseModal = () => {
      if (purchaseBackdrop) {
        purchaseBackdrop.style.display = 'none';
      }
    };

    document.getElementById('price-button')?.addEventListener('click', openPurchaseModal);
    purchaseClose?.addEventListener('click', closePurchaseModal);
    purchaseBackdrop?.addEventListener('click', (e) => {
      if (e.target === purchaseBackdrop) closePurchaseModal();
    });

    document.getElementById('purchase-open-chat-button')?.addEventListener('click', async () => {
      try {
        await ipcRenderer.invoke('openExternalUrl', KAKAO_OPEN_CHAT_URL);
      } catch (error) {
        console.error('ì˜¤í”ˆì±„íŒ… ì—´ê¸° ì‹¤íŒ¨:', error);
      }
    });

    // í¼ ì œì¶œ
    document.getElementById('login-form')?.addEventListener('submit', async (e) => {
      e.preventDefault();
      hideError();

      const loginButton = document.getElementById('login-button');
      const rememberCheckbox = document.getElementById('remember-credentials');

      if (loginButton) {
        loginButton.disabled = true;
        loginButton.textContent = 'ì¸ì¦ ì¤‘...';
      }

      try {
        let result = null;

        if (isReauthMode) {
          // ì¬ì¸ì¦ ëª¨ë“œ: ë“±ë¡ëœ ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸
          const userIdInput = document.getElementById('user-id');
          const passwordInput = document.getElementById('password');

          const userId = userIdInput?.value.trim() || '';
          const password = passwordInput?.value.trim() || '';

          if (!userId || !password) {
            showError('ì•„ì´ë””ì™€ ë¹„ë°€ë²ˆí˜¸ë¥¼ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            if (loginButton) {
              loginButton.disabled = false;
              loginButton.textContent = 'ì¸ì¦í•˜ê¸°';
            }
            return;
          }

          console.log('[Login] ì¬ì¸ì¦ ìš”ì²­ ì‹œì‘:', { userId, deviceId: deviceId.substring(0, 8) + '...' });
          result = await ipcRenderer.invoke('license:verifyWithCredentials', userId, password, deviceId);
          console.log('[Login] ì¬ì¸ì¦ ì‘ë‹µ:', result);
          console.log('[Login] ì¬ì¸ì¦ ì‘ë‹µ ì „ì²´ (JSON):', JSON.stringify(result, null, 2));

          // ë””ë²„ê·¸ ì •ë³´ ì¶œë ¥
          if (result && result.debugInfo) {
            console.log('ğŸ” [Login] ì¬ì¸ì¦ ë””ë²„ê·¸ ì •ë³´:');
            if (result.debugInfo.verify) {
              console.log('ğŸ” [Login] - action:', result.debugInfo.verify.action);
              console.log('ğŸ” [Login] - userId:', result.debugInfo.verify.userId);
              console.log('ğŸ” [Login] - fullResponse:', JSON.stringify(result.debugInfo.verify.fullResponse, null, 2));
              console.log('ğŸ” [Login] - ok:', result.debugInfo.verify.ok);
              console.log('ğŸ” [Login] - valid:', result.debugInfo.verify.valid);
            }
          }

          // âœ… ì‹¤ì œ ì„œë²„ ì‘ë‹µ í™•ì¸: debugInfo.verify.fullResponseì—ì„œ ì²´í¬
          const verifyResponse = result?.debugInfo?.verify?.fullResponse;

          // ì¬ì¸ì¦ ëª¨ë“œì—ì„œëŠ” verifyResponseì˜ okì™€ validë¥¼ í™•ì¸
          if (verifyResponse && verifyResponse.ok !== false && verifyResponse.valid !== false) {
            // ì¬ì¸ì¦ ì„±ê³µ
            console.log('[Login] âœ… ì¬ì¸ì¦ ì„±ê³µ - verifyResponse.ok:', verifyResponse.ok, 'verifyResponse.valid:', verifyResponse.valid);

            // ê¸°ì–µí•˜ê¸° ì²´í¬ë°•ìŠ¤ê°€ ì²´í¬ë˜ì–´ ìˆìœ¼ë©´ ì €ì¥
            if (rememberCheckbox?.checked) {
              try {
                const config = await ipcRenderer.invoke('config:get');
                const updatedConfig = {
                  ...config,
                  rememberLicenseCredentials: true,
                  savedLicenseUserId: userId,
                  savedLicensePassword: password,
                };
                await ipcRenderer.invoke('config:save', updatedConfig);
              } catch (error) {
                console.error('ìê²©ì¦ëª… ì €ì¥ ì‹¤íŒ¨:', error);
              }
            }

            // ì„±ê³µ ë©”ì‹œì§€ í‘œì‹œ ë° ì°½ ë‹«ê¸° (ì¬ì¸ì¦ ëª¨ë“œì—ì„œë„ ë™ì¼í•˜ê²Œ ì²˜ë¦¬)
            const successMessage = document.createElement('div');
            successMessage.style.cssText = 'position: fixed; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #4CAF50; color: white; padding: 30px 50px; border-radius: 10px; font-size: 18px; font-weight: bold; z-index: 10000; box-shadow: 0 4px 20px rgba(0,0,0,0.3); text-align: center;';
            successMessage.textContent = 'ì¶•í•˜í•©ë‹ˆë‹¤ ì¸ì¦ë˜ì…¨ìŠµë‹ˆë‹¤!^^\n(10ì´ˆ í›„ ì°½ì´ ë‹«í™ë‹ˆë‹¤)';
            document.body.appendChild(successMessage);

            console.log('âœ… ì¬ì¸ì¦ ì„±ê³µ! 10ì´ˆ í›„ ì°½ì´ ë‹«í™ë‹ˆë‹¤.');
            setTimeout(async () => {
              await ipcRenderer.invoke('login:success');
              window.close();
            }, 10000);

            // ì¬ì¸ì¦ ëª¨ë“œì—ì„œëŠ” ì—¬ê¸°ì„œ ì¢…ë£Œ (ì´ˆê¸° ì¸ì¦ ëª¨ë“œì˜ ë¡œì§ê³¼ ë¶„ë¦¬)
            return;
          } else {
            // âŒ ì¬ì¸ì¦ ì‹¤íŒ¨
            let errorMessage = 'ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';

            if (verifyResponse) {
              if (verifyResponse.ok === false) {
                errorMessage = verifyResponse.error || verifyResponse.message || 'ì„œë²„ì—ì„œ ì¸ì¦ì„ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤.';
                console.error('[Login] âŒ ì„œë²„ ê±°ë¶€:', errorMessage);
              } else if (verifyResponse.valid === false) {
                errorMessage = verifyResponse.message || verifyResponse.error || 'ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
                console.error('[Login] âŒ ì¸ì¦ ì‹¤íŒ¨:', errorMessage);
              }
            } else if (!result.valid) {
              errorMessage = result.message || 'ì•„ì´ë”” ë˜ëŠ” ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.';
              console.error('[Login] âŒ ì¬ì¸ì¦ ì‹¤íŒ¨ - result.valid:', result.valid, 'result.message:', result.message);
            }

            showError(errorMessage);
            if (loginButton) {
              loginButton.disabled = false;
              loginButton.textContent = 'ì¸ì¦í•˜ê¸°';
            }

            // ì¬ì¸ì¦ ì‹¤íŒ¨ ì‹œ ì²˜ë¦¬ ì¤‘ë‹¨
            return;
          }
        } else {
          // ì´ˆê¸° ì¸ì¦ ëª¨ë“œ: ë¼ì´ì„ ìŠ¤ ì½”ë“œ + ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ + ì´ë©”ì¼
          const codeInput = document.getElementById('license-code-init');
          const userIdInput = document.getElementById('user-id-init');
          const passwordInput = document.getElementById('password-init');
          const emailInput = document.getElementById('email-init');

          const code = codeInput?.value.trim() || '';
          const userId = userIdInput?.value.trim() || '';
          const password = passwordInput?.value.trim() || '';
          const email = emailInput?.value.trim() || '';

          if (!code || !userId || !password || !email) {
            showError('ëª¨ë“  í•„ë“œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
            if (loginButton) {
              loginButton.disabled = false;
              loginButton.textContent = 'ì¸ì¦í•˜ê¸°';
            }
            return;
          }

          // ë¼ì´ì„ ìŠ¤ ì½”ë“œë¡œ ë“±ë¡ (ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ í¬í•¨)
          console.log('[Login] ë“±ë¡ ìš”ì²­ ì‹œì‘:', { code: code.substring(0, 4) + '***', userId, email, deviceId: deviceId.substring(0, 8) + '...' });
          result = await ipcRenderer.invoke('license:register', code, userId, password, email, deviceId);
          console.log('[Login] ë“±ë¡ ì‘ë‹µ:', result);
          console.log('[Login] ë“±ë¡ ì‘ë‹µ ì „ì²´ (JSON):', JSON.stringify(result, null, 2));
          console.log('[Login] debugInfo ì¡´ì¬ ì—¬ë¶€:', result && result.debugInfo ? 'ìˆìŒ' : 'ì—†ìŒ');

          // ë””ë²„ê·¸ ì •ë³´ ì¶œë ¥ (ë¸Œë¼ìš°ì € ì½˜ì†”ì—ì„œ í™•ì¸ ê°€ëŠ¥)
          console.log('ğŸ” [licenseManager] ========================================');
          console.log('ğŸ” [licenseManager] ë””ë²„ê·¸ ì •ë³´ ì¶œë ¥ ì‹œì‘');

          if (result && result.debugInfo) {
            console.log('ğŸ” [licenseManager] ì„œë²„ ë””ë²„ê·¸ ì •ë³´ (register):');
            if (result.debugInfo.register) {
              console.log('ğŸ” [licenseManager] - usedValue:', result.debugInfo.register.usedValue);
              console.log('ğŸ” [licenseManager] - usedCheck:', result.debugInfo.register.usedCheck);
              console.log('ğŸ” [licenseManager] - used:', result.debugInfo.register.used);
              console.log('ğŸ” [licenseManager] - isUsed:', result.debugInfo.register.isUsed);
              console.log('ğŸ” [licenseManager] - action:', result.debugInfo.register.action);
              console.log('ğŸ” [licenseManager] - licenseCode:', result.debugInfo.register.licenseCode);
              console.log('ğŸ” [licenseManager] - ì „ì²´ ì‘ë‹µ:', JSON.stringify(result.debugInfo.register.fullResponse, null, 2));
            } else {
              console.warn('ğŸ” [licenseManager] - register ë””ë²„ê·¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤');
            }

            if (result.debugInfo.verify) {
              console.log('ğŸ” [licenseManager] ========================================');
              console.log('ğŸ” [licenseManager] verify ì•¡ì…˜ ì‘ë‹µ ë””ë²„ê·¸ ì •ë³´:');
              console.log('ğŸ” [licenseManager] - usedValue:', result.debugInfo.verify.usedValue);
              console.log('ğŸ” [licenseManager] - usedCheck:', result.debugInfo.verify.usedCheck);
              console.log('ğŸ” [licenseManager] - used:', result.debugInfo.verify.used);
              console.log('ğŸ” [licenseManager] - isUsed:', result.debugInfo.verify.isUsed);
              console.log('ğŸ” [licenseManager] - action:', result.debugInfo.verify.action);
              console.log('ğŸ” [licenseManager] - code:', result.debugInfo.verify.code);
              if (result.debugInfo.verify.fullResponse) {
                console.log('ğŸ” [licenseManager] - ì „ì²´ ì‘ë‹µ:', JSON.stringify(result.debugInfo.verify.fullResponse, null, 2));
              }
              if (result.debugInfo.verify.error) {
                console.warn('ğŸ” [licenseManager] - verify ì˜¤ë¥˜:', result.debugInfo.verify.error);
              }
            } else {
              console.warn('ğŸ” [licenseManager] - verify ë””ë²„ê·¸ ì •ë³´ê°€ ì—†ìŠµë‹ˆë‹¤');
            }
          } else {
            console.warn('ğŸ” [licenseManager] - debugInfoê°€ ì‘ë‹µì— ì—†ìŠµë‹ˆë‹¤. result:', result);
            console.warn('ğŸ” [licenseManager] - result íƒ€ì…:', typeof result);
            console.warn('ğŸ” [licenseManager] - result í‚¤:', result ? Object.keys(result) : 'null');
          }
          console.log('ğŸ” [licenseManager] ========================================');
        }

        // âœ… ì´ˆê¸° ì¸ì¦ ëª¨ë“œ: ì‹¤ì œ ì„œë²„ ì‘ë‹µ í™•ì¸
        // [ìˆ˜ì •] ì§€ë‚˜ì¹˜ê²Œ ì—„ê²©í•œ ì²´í¬(registerResponse.ok === true) ëŒ€ì‹  
        // ë©”ì¸ í”„ë¡œì„¸ìŠ¤ì—ì„œ ìµœì¢… íŒì •í•œ result.valid ë˜ëŠ” 
        // ì„œë²„ì˜ ëª…ì‹œì  ê±°ë¶€(ok === false)ê°€ ì•„ë‹Œ ê²½ìš°ë¥¼ ì„±ê³µìœ¼ë¡œ ê°„ì£¼
        const registerResponse = result?.debugInfo?.register?.fullResponse;
        const isActuallyValid = result?.valid === true || (registerResponse && registerResponse.ok !== false && registerResponse.valid !== false);

        if (isActuallyValid) {
          // ì¸ì¦ ì„±ê³µ - ì¶•í•˜ ë©”ì‹œì§€ í‘œì‹œ
          console.log('[Login] âœ… ë“±ë¡ ì„±ê³µ - result.valid:', result?.valid, 'registerResponse.ok:', registerResponse?.ok);

          // ì´ˆê¸° ì¸ì¦ ëª¨ë“œì¸ ê²½ìš° ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ìë™ ì €ì¥ (2ì°¨ ë¡œê·¸ì¸ì„ ìœ„í•´)
          if (!isReauthMode) {
            try {
              const userIdInput = document.getElementById('user-id-init');
              const passwordInput = document.getElementById('password-init');

              const userId = (userIdInput && userIdInput.value) ? userIdInput.value.trim() : '';
              const password = (passwordInput && passwordInput.value) ? passwordInput.value.trim() : '';

              if (userId && password) {
                console.log('[Login] ì´ˆê¸° ì¸ì¦ ì„±ê³µ - ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ìë™ ì €ì¥ (2ì°¨ ë¡œê·¸ì¸ìš©)');
                const config = await ipcRenderer.invoke('config:get');
                const updatedConfig = {
                  ...config,
                  rememberLicenseCredentials: true,
                  savedLicenseUserId: userId,
                  savedLicensePassword: password,
                };
                await ipcRenderer.invoke('config:save', updatedConfig);
                console.log('[Login] ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ì €ì¥ ì™„ë£Œ');
              }
            } catch (error) {
              console.error('[Login] ì•„ì´ë””/ë¹„ë°€ë²ˆí˜¸ ì €ì¥ ì‹¤íŒ¨:', error);
            }
          }

          // [ê°œì„ ] ê³ ê¸‰ìŠ¤ëŸ¬ìš´ ì„±ê³µ ëª¨ë‹¬ í‘œì‹œ
          const successBackdrop = document.getElementById('success-modal-backdrop');
          const periodDisplay = document.getElementById('license-period-display');

          if (successBackdrop && periodDisplay) {
            // ê¸°ê°„ ì •ë³´ ì¶”ì¶œ ë° í¬ë§·íŒ…
            let displayDate = 'í‰ìƒê¶Œ';

            // registerResponse ë˜ëŠ” result.licenseì—ì„œ ë§Œë£Œì¼ í™•ì¸
            const rawExpiresAt = registerResponse?.expiresAt || registerResponse?.expires || result?.license?.expiresAt;
            const licenseType = registerResponse?.type || registerResponse?.licenseType || result?.license?.licenseType;

            if (licenseType === 'LIFE' || licenseType === 'premium' && !rawExpiresAt) {
              displayDate = 'ë¬´ì œí•œ (í‰ìƒê¶Œ)';
            } else if (rawExpiresAt) {
              try {
                const now = new Date();
                const expireDate = new Date(rawExpiresAt);

                // ë‚ ì§œ í¬ë§· (YYYYë…„ MMì›” DDì¼)
                const formattedDate = `${expireDate.getFullYear()}ë…„ ${expireDate.getMonth() + 1}ì›” ${expireDate.getDate()}ì¼`;

                // ë‚¨ì€ ê¸°ê°„ ê³„ì‚° (ì¼ ë‹¨ìœ„)
                const diffTime = expireDate.getTime() - now.getTime();
                const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

                let durationText = '';
                if (diffDays > 300) durationText = ' (1ë…„ê¶Œ)';
                else if (diffDays > 270) durationText = ' (9ê°œì›”ê¶Œ)';
                else if (diffDays > 150) durationText = ' (6ê°œì›”ê¶Œ)';
                else if (diffDays > 80) durationText = ' (3ê°œì›”ê¶Œ)';
                else if (diffDays > 25) durationText = ' (1ê°œì›”ê¶Œ)';
                else if (diffDays > 0) durationText = ` (${diffDays}ì¼ ë‚¨ìŒ)`;

                displayDate = `${formattedDate}${durationText} ê¹Œì§€`;
              } catch (e) {
                displayDate = String(rawExpiresAt);
              }
            } else if (licenseType === 'trial') {
              displayDate = 'ì²´í—˜íŒ (ê¸°ê°„ í•œì •)';
            } else if (licenseType === 'free') {
              displayDate = 'ë¬´ë£Œ ë²„ì „';
            }

            periodDisplay.textContent = displayDate;
            successBackdrop.style.display = 'flex';
          }

          console.log('âœ… ì¸ì¦ ì„±ê³µ! ë©”ì¸ ì°½ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.');
          setTimeout(async () => {
            await ipcRenderer.invoke('login:success');
            window.close();
          }, 3500); // 3.5ì´ˆ í›„ ì´ë™
        } else {
          // âŒ ì—ëŸ¬ ì²˜ë¦¬: ë“±ë¡ ì‹¤íŒ¨
          let errorMessage = 'ë¼ì´ì„ ìŠ¤ ë“±ë¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';

          if (registerResponse) {
            if (registerResponse.ok === false) {
              // ì„œë²„ê°€ ëª…ì‹œì ìœ¼ë¡œ ê±°ë¶€í•œ ê²½ìš° (used ìƒíƒœê°€ ì €ì¥ë˜ì§€ ì•ŠìŒ)
              errorMessage = registerResponse.error || registerResponse.message || 'ì„œë²„ì—ì„œ ë“±ë¡ì„ ê±°ë¶€í–ˆìŠµë‹ˆë‹¤.';
              console.error('[Login] âŒ ì„œë²„ ê±°ë¶€ (ë“±ë¡ë˜ì§€ ì•ŠìŒ, used ìƒíƒœ ì €ì¥ ì•ˆ ë¨):', errorMessage);
              console.error('[Login] âŒ debugInfo.register.fullResponse:', JSON.stringify(registerResponse, null, 2));

              // used ìƒíƒœê°€ ì €ì¥ë˜ì§€ ì•Šì•˜ìŒì„ ëª…í™•íˆ í‘œì‹œ
              if (result.debugInfo && result.debugInfo.register) {
                console.error('[Login] âŒ register ë””ë²„ê·¸ ì •ë³´:', {
                  usedValue: result.debugInfo.register.usedValue,
                  usedCheck: result.debugInfo.register.usedCheck,
                  used: result.debugInfo.register.used,
                  isUsed: result.debugInfo.register.isUsed,
                });
              }
            } else if (registerResponse.valid === false) {
              // ì¸ì¦ ì‹¤íŒ¨
              errorMessage = registerResponse.message || registerResponse.error || 'ì¸ì¦ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.';
              console.error('[Login] âŒ ì¸ì¦ ì‹¤íŒ¨:', errorMessage);
              console.error('[Login] âŒ debugInfo.register.fullResponse:', JSON.stringify(registerResponse, null, 2));
            } else {
              // ì‘ë‹µ í˜•ì‹ ì˜¤ë¥˜ (registerResponse.okë‚˜ registerResponse.validê°€ ì—†ëŠ” ê²½ìš°)
              errorMessage = 'ì„œë²„ ì‘ë‹µ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.';
              console.error('[Login] âŒ ì‘ë‹µ í˜•ì‹ ì˜¤ë¥˜:', registerResponse);
              console.error('[Login] âŒ registerResponse.ok:', registerResponse.ok, 'registerResponse.valid:', registerResponse.valid);
            }
          } else {
            // registerResponseê°€ ì—†ëŠ” ê²½ìš° (debugInfoê°€ ì—†ê±°ë‚˜ register ì •ë³´ê°€ ì—†ëŠ” ê²½ìš°)
            errorMessage = 'ì„œë²„ ì‘ë‹µ í˜•ì‹ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. ê´€ë¦¬ìì—ê²Œ ë¬¸ì˜í•˜ì„¸ìš”.';
            console.error('[Login] âŒ ì¸ì¦ ì‹¤íŒ¨ - registerResponseê°€ ì—†ìŒ');
            console.error('[Login] âŒ result:', result);
            console.error('[Login] âŒ result.debugInfo:', result?.debugInfo);
            console.error('[Login] âŒ result.debugInfo?.register:', result?.debugInfo?.register);
          }

          // ì—ëŸ¬ ë©”ì‹œì§€ í‘œì‹œ ë° ì²˜ë¦¬ ì¤‘ë‹¨
          const displayMsg = typeof errorMessage === 'string' ? errorMessage : JSON.stringify(errorMessage);
          showError(displayMsg);
          if (loginButton) {
            loginButton.disabled = false;
            loginButton.textContent = 'ì¸ì¦í•˜ê¸°';
          }

          // ë“±ë¡ ì¤‘ë‹¨ (ì„±ê³µ ì²˜ë¦¬ë¡œ ë„˜ì–´ê°€ì§€ ì•ŠìŒ)
          return;
        }
      } catch (error) {
        console.error('[Login] ì¸ì¦ ì¤‘ ì˜ˆì™¸ ë°œìƒ:', error);
        console.error('[Login] ì˜¤ë¥˜ ìƒì„¸:', {
          message: error.message,
          stack: error.stack,
          name: error.name
        });
        showError(`ì˜¤ë¥˜: ${error.message}`);
        if (loginButton) {
          loginButton.disabled = false;
          loginButton.textContent = 'ì¸ì¦í•˜ê¸°';
        }
      }
    });


    // ì´ˆê¸°í™” (ì´ˆê¸° ì¸ì¦ì°½ì„ ë¨¼ì € í‘œì‹œ, ìë™ ë¡œê·¸ì¸ í•˜ì§€ ì•ŠìŒ)
    async function initialize() {
      await loadDeviceId();
      await loadAppVersion(); // âœ… [2026-02-05] ë²„ì „ í‘œì‹œ
      await loadSavedCredentials();

      // âœ… ë¬´ë£Œë¡œ ì²´í—˜í•˜ê¸° ë²„íŠ¼ í™œì„±í™” ì—¬ë¶€ ì²´í¬
      try {
        const config = await ipcRenderer.invoke('config:get');
        if (config && config.enableFreeTrialButton === false) {
          const freeBtn = document.getElementById('free-use-button');
          if (freeBtn) freeBtn.style.display = 'none';
          console.log('[Login] ë¬´ë£Œ ì²´í—˜ ë²„íŠ¼ì´ ë¹„í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤. (ì„¤ì • ê¸°ë°˜)');
        }
      } catch (e) {
        console.error('[Login] ì„¤ì • ë¡œë“œ ì¤‘ ì˜¤ë¥˜:', e);
      }

      // ì´ˆê¸° ì¸ì¦ì°½ì´ ê¸°ë³¸ìœ¼ë¡œ í‘œì‹œë˜ë„ë¡ í•¨ (ìë™ ë¡œê·¸ì¸ í•˜ì§€ ì•ŠìŒ)
      console.log('ì´ˆê¸° ì¸ì¦ì°½ì„ í‘œì‹œí•©ë‹ˆë‹¤. "ì´ë¯¸ ë“±ë¡í–ˆë‚˜ìš”?"ë¥¼ í´ë¦­í•˜ë©´ ì¬ì¸ì¦ ëª¨ë“œë¡œ ì „í™˜ë©ë‹ˆë‹¤.');

      // ê´€ë¦¬ì ì œì–´ ì´ˆê¸°í™”
      initAdminPanel();
    }

    function initAdminPanel() {
      const trigger = document.getElementById('admin-trigger');
      const backdrop = document.getElementById('admin-modal-backdrop');
      const authSection = document.getElementById('admin-auth-section');
      const controlPanel = document.getElementById('admin-control-panel');
      const passwordInput = document.getElementById('admin-password');
      const confirmBtn = document.getElementById('admin-confirm-btn');
      const cancelBtn = document.getElementById('admin-cancel-btn');
      const closeBtn = document.getElementById('admin-close-btn');
      const enableTrialCheckbox = document.getElementById('admin-enable-free-trial');

      trigger?.addEventListener('click', () => {
        backdrop.style.display = 'flex';
        authSection.style.display = 'block';
        controlPanel.style.display = 'none';
        passwordInput.value = '';
        passwordInput.focus();
      });

      confirmBtn?.addEventListener('click', async () => {
        if (passwordInput.value === '@qkrtjdgus12') { // ë³€ê²½ëœ ê´€ë¦¬ì ë¹„ë°€ë²ˆí˜¸
          authSection.style.display = 'none';
          controlPanel.style.display = 'block';

          const config = await ipcRenderer.invoke('config:get');
          enableTrialCheckbox.checked = config?.enableFreeTrialButton ?? true;
        } else {
          alert('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.');
        }
      });

      enableTrialCheckbox?.addEventListener('change', async () => {
        const config = await ipcRenderer.invoke('config:get');
        const newConfig = { ...config, enableFreeTrialButton: enableTrialCheckbox.checked };
        await ipcRenderer.invoke('config:save', newConfig);

        const freeBtn = document.getElementById('free-use-button');
        if (freeBtn) {
          freeBtn.style.display = enableTrialCheckbox.checked ? 'block' : 'none';
        }
      });

      [cancelBtn, closeBtn].forEach(btn => btn?.addEventListener('click', () => {
        backdrop.style.display = 'none';
      }));
    }

    initialize();
  </script>
  <!-- ê´€ë¦¬ì ëª¨ë‹¬ -->
  <div id="admin-modal-backdrop" class="admin-modal-backdrop">
    <div class="admin-modal">
      <h3 style="color: var(--text-gold); margin-bottom: 16px; font-size: 16px;">ğŸ” ê´€ë¦¬ì ì¸ì¦</h3>
      <div id="admin-auth-section">
        <input type="password" id="admin-password" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
        <div class="admin-modal-actions">
          <button id="admin-cancel-btn" class="admin-btn-cancel">ì·¨ì†Œ</button>
          <button id="admin-confirm-btn" class="admin-btn-confirm">í™•ì¸</button>
        </div>
      </div>
      <div id="admin-control-panel" class="admin-control-panel">
        <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px;">
          <span style="color: var(--text-gold); font-size: 14px;">ë¬´ë£Œ ì²´í—˜ ë²„íŠ¼ í‘œì‹œ</span>
          <input type="checkbox" id="admin-enable-free-trial" style="width: 20px; height: 20px; margin: 0;">
        </div>
        <button id="admin-close-btn" class="admin-btn-cancel" style="width: 100%;">ë‹«ê¸°</button>
      </div>
    </div>
  </div>

  <div id="admin-trigger" class="admin-trigger">âš™ï¸</div>
</body>

</html>